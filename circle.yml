general:
  branches:
    only:
      - master

checkout:
  post:
    - git submodule sync
    - git submodule update --init # use submodules
    - gem install htmlbeautifier

test:
  override:
    - git fetch
    - git config --global user.email "julian+bot@jnadeau.ca" && git config --global user.name "Julian Bot"

    - ruby ./.diatex/diatex ../
    - git status
    - git add --all .
    - git commit -m 'Convert latex and diagram to images. Re-gen table of contents' || true
    - git push origin master || true

    - mv jekyll/* .
    - ruby ./bin/toc.rb
    - git status
    - git add --all .
    - git commit -m 'Build jekyll site' || true
    - git push origin HEAD:gh-pages -f || true